[tox]
envlist = py39, py310, py311, py312, flake8, mypy, coverage
skip_missing_interpreters = true

[testenv]
deps =
    pytest>=6.0
    pytest-cov
    pytest-mock
    pytest-benchmark
    pytest-xdist
    hypothesis
    factory-boy
    freezegun
    requests-mock
    responses
    faker
    numpy
    pandas
    scikit-learn
    xgboost
    lightgbm
commands =
    pytest {posargs}

[testenv:unit]
commands =
    pytest tests/unit/ -v --cov=src --cov-report=term-missing

[testenv:integration]
commands =
    pytest tests/integration/ -v --tb=short

[testenv:performance]
commands =
    pytest tests/performance/ -v --benchmark-only --benchmark-sort=mean

[testenv:accuracy]
commands =
    pytest tests/ -m accuracy -v

[testenv:latency]
commands =
    pytest tests/ -m latency -v

[testenv:throughput]
commands =
    pytest tests/ -m throughput -v

[testenv:flake8]
deps = flake8
commands = flake8 src tests

[testenv:mypy]
deps =
    mypy
    types-requests
commands = mypy src

[testenv:coverage]
deps =
    coverage[toml]
    pytest
    pytest-cov
commands =
    coverage erase
    pytest --cov=src --cov-report=term-missing --cov-report=html
    coverage report --fail-under=80

[testenv:security]
deps = bandit
commands = bandit -r src/

[flake8]
max-line-length = 88
extend-ignore = E203, W503
exclude = .tox, .git, __pycache__, docs/*, build/, dist/, *.egg